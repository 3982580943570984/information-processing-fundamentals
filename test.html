<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cytoscape Packet Movement</title>
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <style>
        #cy {
            width: 600px;
            height: 600px;
            display: block;
            background-color: black;
        }
    </style>
</head>

<body>

    <div id="cy"></div>

    <script>
        // Инициализация графа
        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: [
                { data: { id: 'A', label: 'A' } },
                { data: { id: 'B', label: 'B' } },
                { data: { id: 'C', label: 'C' } },
                { data: { id: 'AB', source: 'A', target: 'B' } },
                { data: { id: 'BC', source: 'B', target: 'C' } }
            ],
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': '#0074D9',
                        'label': 'data(label)',
                        'color': '#fff',
                        'text-halign': 'center',
                        'text-valign': 'center'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 3,
                        'line-color': '#ccc',
                        'target-arrow-color': '#ccc',
                        'target-arrow-shape': 'triangle'
                    }
                },
                {
                    selector: 'node.packet',
                    style: {
                        'width': 10,
                        'height': 10,
                        'background-color': 'red',
                        // 'label': 'data(label)'
                    }
                }
            ]
        });

        // Функция для анимации движения пакета между двумя узлами
        const animatePacket = (sourceNodeId, targetNodeId) => {
            return new Promise((resolve) => {
                const sourceNode = cy.getElementById(sourceNodeId);
                const targetNode = cy.getElementById(targetNodeId);

                // Получаем позиции исходного и целевого узлов
                const sourcePosition = sourceNode.position();
                const targetPosition = targetNode.position();

                // Создаем "пакет" как отдельный временный элемент
                const packet = cy.add({
                    data: { label: 'packet' },
                    position: { ...sourcePosition },
                    classes: 'packet'
                });

                // Анимация перемещения пакета
                packet.animate({
                    position: { ...targetPosition },  // Позиция целевого узла
                    duration: 2000,
                    complete: () => {
                        packet.remove();  // Удалить пакет после перемещения
                        resolve();  // Разрешаем промис после завершения анимации
                    }
                });
            });
        };

        // Использование async/await для последовательной анимации
        const animatePacketsInSequence = async () => {
            await animatePacket('A', 'B');
            await animatePacket('B', 'C');
        };

        // Запуск последовательной анимации
        animatePacketsInSequence();

    </script>

</body>

</html>